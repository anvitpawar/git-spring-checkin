function parseProfileString(str) {
  return str.split('\n').map((line) => {
    line = line.trim();
    let key = '', value = '', delimiter = '';
    let isPlainText = false;

    // Shell keywords or compound statements to treat as plain text
    const shellPattern = /\b(if|fi|elif|else|then|do|done|while|for|echo|export|exit)\b/;
    const compoundBashPattern = /(;|\[.*\]\s*;)/; // detect compound statements like: if [ .. ]; then

    // Mark as plain text if it's a bash statement
    if (shellPattern.test(line) || compoundBashPattern.test(line)) {
      isPlainText = true;
      return { key: line, value: '', delimiter: 'none', isPlainText };
    }

    const colonIndex = line.indexOf(':');
    const equalIndex = line.indexOf('=');

    if (colonIndex !== -1) {
      key = line.slice(0, colonIndex).trim();
      value = line.slice(colonIndex + 1).trim();
      delimiter = 'colon';
    } else if (equalIndex !== -1) {
      key = line.slice(0, equalIndex).trim();
      value = line.slice(equalIndex + 1).trim();
      delimiter = 'equal';
    } else {
      key = line;
      delimiter = 'none';
    }

    // Strip trailing "\" if present
    if (key.startsWith('')) key = key.slice(1, -1);
    if (value.endsWith(',\\')) value = value.slice(0, -2).trim();

    return { key, value, delimiter, isPlainText };
  });
}