let isPlainText = false;

if (
  delimiter === 'none' ||
  /^(export|if|fi|elif|else|then|do|done|while|for|echo)\b/.test(key) ||
  /[`$()]/.test(value) ||                // command substitutions
  /^$begin:math:display$.*$end:math:display$$/.test(line.trim()) ||       // shell test expressions
  /^\s*$begin:math:display$.*$end:math:display$\s*;?\s*(then)?$/.test(line.trim()) || // test condition with 'then'
  /^\s*exit\s+\d+/.test(line.trim())    // exit statements
) {
  isPlainText = true;
}